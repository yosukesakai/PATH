# PATH - ユーザが対象をみるふるまいに応じて異なる映像を呈示するシステム  
顔・両眼位置、距離、明度などに応じ、撮影位置・撮影速度の異なる映像を提示できます  

### PATH - Interactive System for Displaying Different Videos Depending on User's Behavior to See Objects  
Display Videos Recorded at Different Positions or Speeds Depending on Position of User's Face and Eyes, Distance, Brightness and so on.  

Currently Japanese Only  
システム概要およびこれをもとに制作された"PATH01"について、下記テキストに記載されています  

	第 15 回日本バーチャルリアリティ学会大会論文集(2010 年)-ユーザの顔・両眼位置に応じ撮影位置・ 度の異なる 映像を呈示するシステム

なお、Kazuhisa Uchihashi氏 + UA氏によるpathとは関係ありません。  

# 1. システムを制作した背景とこれまでの経緯

写真や絵画などを見るとき,より詳細に見たいときは近づいてその部分をより大きく見たり,全体を見たいときは 離れたりする.これは人々が日常的に行っていることで, 特に意識しないで実践しているふるまいである.歩行やそ れに準ずる移動によるこうした行動は,視覚のみならない 感覚に関わる原初的なふるまい・身ぶりであり,重要性が 高いと考えられる.    

ヒトが何かを見るとき,それをどのように見たいか,どの ような部分を見たいかという願望はユーザのふるまいに 反映され,希望する“見え”を得ることになる.対象をより 近くで見たいときは近づく,より詳しく見たいときはみつ めるといった行為が,ユーザとディスプレイとの距離・位 置・滞在時間に現れているととらえ,ユーザの顔・両眼位 置を検出し提示の仕方を変化させるインタラクションを 取り入れた映像・音響呈示システムの開発を試みた.  
  
位置の検出は、CV、赤外線センサなど様々な方法が考えられます。ユーザの位置だけでなく、気温や照度といった環境情報をとりいれることで、映像を提示するインテリアなどへ展開することもできるでしょう。  

また,動きの速いものでも注視すればその動きをとらえることができる,いわば時間解像度の向上のインタラクションを,ハイスピード撮影・スロー再生を用いて導入できると考えられます。  

ユーザ位置の推定にCVによる顔検出を利用し、本システムを用いて異なる映像を提示する作品"PATH 01"があります。この鑑賞者は、以下のように評価しています。

・ ユーザの誘導は有効であった  ・ 時間解像度のインタラクションは受け入れがスムースかつ訴求力が高く有効だった  ・ ディゾルブ処理はインタラクションの理解を助ける  
・ 特徴検出に時間がかかりレスポンスが遅い  ・ 特徴検出により観賞以外の鑑賞者の行動を省き誤動作を防げた  
・ 自宅におきたい  

他に、ユーザの位置の検出を赤外線センサ (kinect) を利用し、PATHをそのシステムのコアに用いた作品"ALLEY Installation"も制作されました。  

本コードはopenFrameworksで利用されることを前提としています。またApache License 2.0を適用し公開されています。ライセンスの範囲で教育、商用などに自由に利用することができます。詳細はソースコードの冒頭のライセンス表記をご覧ください。  

	PATH(ofApp) by SAKAI Yosuke is licensed under the Apache License, Version2.0


# 2. 構造の概要  

### 2.1 映像の流れ
本システムは、ユーザのふるまいを1つのパラメータ(装置からの距離など)でとらえ、これに応じて4つのムービーを再生、提示します。基本的な流れは、バックグラウンド映像を流している提示装置にユーザが近づき、1つ目の映像が提示され、さらに近づくと2つ目の映像、さらに近づくと3つ目の映像、3つ目の映像が提示される位置でしばらく滞在すると4つ目の映像が再生される、というものです。 

- バックグラウンド映像 > 1つ目の映像 > 2つ目の映像 > 3つ目の映像 > 4つ目の映像  

映像ファイルとしてはそれぞれ、bgmovie.mov、sq0x01.mov、sq0x02.mov、sq0x03.mov、sq0x04.mov というファイルが読み込まれます(xはシーンの番号)。  

### 2.2 映像の切り替え (遷移)

映像の切り替わりは、アルファチャンネルを調整することで、ディゾルブのような効果を出しています。  
これらの映像の変化は、距離と連動します (1次関数)。1つ目の映像と2つ目の映像とが切り替わる閾値 (distanceThreshold1)、2つ目の映像と3つ目の映像とが切り替わる閾値 (distanceThreshold2) を入力します。バックグラウンド映像から1つ目の映像に切り替わる閾値 (limit_distance) は自動的に推定されます。  
3つ目の映像から4つ目の映像に切り替わるための滞在時間は、近接滞在時間(closepositionStayingTime)として示されます。これを設定します。遠ざかる場合は、逆に進行します。  

すなわち、以下のように示されます。  

- bgmovie.mov < [ limit_distance ] >  sq0x01.mov < [ distanceThreshold1 ] < sq0x02.mov > [ distanceThreshold2 ] < sq0x03.mov > [ closepositionStayingTime ] >  sq0x04.mov


検出された距離の値は、まずfirst_distanceに代入し、その後スムージングしてからfinal_distanceに示されます。 

### 2.3 映像のハンドリング
ムービーは最初に全て読み込まれ (プラットフォームによりますが、ここで利用しているclassではupdateでファイルのloadができない場合があります) ループ再生されます、必要に応じてアルファチャンネルが変化し、その映像が表示される仕組みになっています。試行して問題なければ、都度loadする方がリソースを節約できるでしょう。  

### 2.3 シーンについて
初期システムに求められた要件を受けて、切り替わる映像の組(sq0x01.mov、sq0x02.mov、sq0x03.mov、sq0x04.mov)をシーンと呼び、3つのシーンを扱うように設計されています。シーンの遷移はマニュアルであれ、自動であれ個別に実装してください (一部コメントアウトされて残っているものもあります)。シーン数は必要に応じて増減します。  
 
遷移の条件について、当初のシステムでは、一度人が最近接して一定時間滞在した後に (gotonextscene =1になってから)、noStayingTimeを加算し、人がいなくなると次のsceneへ遷移していました。遷移のきっかけはトリガー (scenechange = 1) で判断します。
 
### 2.4 距離の算出/照度センサの扱いのTIPS
距離を検出する処理のTipsをいくつか紹介しておきます。赤外線センサで直接距離を検出する場合は特に何もすることはありません。たとえばkinectで検出した値 (nearestpoint_distance_kinect) をfirst_distanceに代入します。  
CV(顔検出)を用いる場合、検出された顔の幅が大きければ大きいほど近づいている、と推定します。閾値の初期設定はそれぞれ800と1000です (もちろん環境に応じて変更してください)。この条件で、MacBook Proの内蔵iSigntを用いる場合は (もちろん利用したい条件によりますが) 以下の方法で安定的に利用することができました。  
 
 	first_distance = 2440 - longestWidth*24;  
 
なお、iPhoneの照度センサを用いる場合、明るさ(brightness)は0-1で提供されます。  
たとえば  

 	日中の室内: 0.35  
 	暗い室内: 0.00002  

これをデフォルトの閾値で利用する場合、例えば以下のようにfirst_distanceを準備します。

	first_distance = brightness*5000;

具体的には以下のようになります。

 	日中の室内: 0.35 >  1750
 	暗い室内: 0.00002 > 0.1  

### 2.5 一定のフレームごとの処理 
 特にCVの検出処理などの重い処理は、毎フレームではなく、一定フレーム (一定時間) ごとに処理するのが良いでしょう。一定時間過ぎたことを示すのがelapsedTimeboolです。経過時間を示す変数は2種類 (framerateA、framerateB) 用意しており、ユーザーが最近接していれば(3つ目のムービーを再生している時は)、framerateAごとに、そうでなければframerateBごとに処理する (elapsedTimeboolがtrueになる) ようになっています。  
 
 
####　参考

以下を目安にコンテンツを調整しています。  

各映像の提示の際、映像だけでなく音量も大変重要な要素です。たとえば、近づくにつれ (sq0x01.movからsq0x04.movへ移るにつれ) 音量が大きくなるよう、元の映像ファイルの音量を調節しておくのが良いでしょう。 

	音量設定
	bgmovie -40db highpass 300Hz  
 	sqx01 -30  
 	sqx02 -20  
 	sqx03 -20  
 	sqx04 -10  
 
 ムービーの書き出し設定は、求められる画質や処理に用いるコンピュータのスペックによって適切に設定すべきでしょう。
 
 	ムービー書き出し設定(FCP)  
 	書き出し>QT変換  
 	H.264  
 	480x640  
 	高品質  
 	フィルタ:なし (使うなら事前に)  
 	AAC  
 	256kbps  
 
 